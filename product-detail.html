<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Everything Shop - All Products</title>
    <!-- Favicon Link: This will display an image in the browser tab -->
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/10B981/ffffff?text=ES">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light blue-gray for background */
            padding-top: 72px; /* Added padding to prevent content from going under the fixed header */
        }
        /* Custom scrollbar for aesthetic appeal */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0; /* Light gray */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; /* Medium gray */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* Darker gray on hover */
        }
        /* Basic spinner for loading state */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #10B981; /* Green color for spinner */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Ephemeral message box styles */
        .ephemeral-message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            z-index: 1000;
            text-wrap: balance; /* Improves text wrapping for messages */
            max-width: 90%;
        }
        .ephemeral-message-box.visible {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header Section (Consistent with Landing Page) -->
    <!-- Added fixed, top-0, and w-full to make the header static -->
    <header class="bg-white shadow-sm py-4 px-6 md:px-8 lg:px-12 flex justify-between items-center rounded-b-xl fixed top-0 w-full z-50">
        <!-- Logo -->
        <div class="flex items-center space-x-2">
            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.592 1L21 12l-4.408 3.592c-.512.598-1.482 1-2.592 1-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2z"></path>
            </svg>
            <a href="index.html" class="text-2xl font-bold text-gray-800">The Everything Shop</a>
        </div>

        <!-- Navigation Menu -->
        <nav class="hidden md:flex space-x-8">
            <a href="index.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300">Home</a>
            <a href="productlisting.html" class="text-green-700 font-bold transition duration-300">Shop</a> <!-- Highlight current page -->
            <a href="shoppingcarts.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300">Cart</a>
            <a href="checkout.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300">Checkout</a>
            <a href="orderconfirmation.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300">Confirmation</a>
            <a href="aboutus.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300">About Us</a>
            <a href="contact.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300">Contact</a>
            <!-- Dynamic Account/Logout Link -->
            <span id="auth-link-container">
                <a href="authentication.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300" id="account-link">Account</a>
            </span>
        </nav>

        <!-- Call to Action / Icons -->
        <div class="flex items-center space-x-4">
            <!-- Cart Icon -->
            <a href="shoppingcarts.html" id="cart-icon" class="text-gray-600 hover:text-green-700 relative transition duration-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.182 1.705.53 1.705H17m-7 0a2 2 0 11-4 0 2 2 0 014 0zm7 0a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
            </a>
            <button class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 hidden sm:block">
                Shop Now
            </button>
            <!-- Mobile Menu Button -->
            <button class="md:hidden text-gray-600 hover:text-green-700 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Content Section: Product Listing -->
    <main class="py-16 md:py-20 px-6 md:px-8 lg:px-12">
        <div class="container mx-auto">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 text-center mb-12">Our Sustainable Collection</h1>

            <!-- Filter, Sort, and Search Section -->
            <div class="flex flex-col sm:flex-row justify-between items-center mb-10 space-y-4 sm:space-y-0">
                <!-- Search Input -->
                <div class="flex items-center space-x-3 mb-4 sm:mb-0 w-full sm:w-auto">
                    <label for="search-input" class="sr-only">Search products</label>
                    <input type="text" id="search-input" placeholder="Search products..." class="p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500 w-full">
                </div>

                <div class="flex items-center space-x-3">
                    <label for="sort-by" class="text-gray-700 font-medium">Sort by:</label>
                    <select id="sort-by" class="p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500">
                        <option value="recommended">Recommended</option>
                        <option value="price-asc">Price: Low to High</option>
                        <option value="price-desc">Price: High to Low</option>
                        <option value="new-arrivals">New Arrivals</option>
                    </select>
                </div>
                <div class="flex items-center space-x-3">
                    <label for="filter-category" class="text-gray-700 font-medium">Category:</label>
                    <select id="filter-category" class="p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500">
                        <option value="all">All Categories</option>
                        <option value="home">Home & Living</option>
                        <option value="personal-care">Personal Care</option>
                        <option value="accessories">Accessories</option>
                        <option value="kitchen">Kitchen</option>
                        <option value="electronics">Electronics</option>
                        <option value="apparel">Apparel</option>
                        <option value="kids-baby">Kids & Baby</option>
                        <option value="outdoor">Outdoor</option>
                        <option value="books">Books & Media</option>
                    </select>
                </div>
                <div id="product-count" class="text-gray-600">
                    Loading products...
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="flex justify-center items-center py-10 hidden">
                <div class="spinner"></div>
            </div>

            <!-- Products Grid -->
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                <!-- Products will be dynamically loaded here by JavaScript -->
            </div>

            <!-- No Products Found Message -->
            <div id="no-products-message" class="hidden text-center text-gray-600 text-lg mt-10">
                No products found matching your criteria.
            </div>

            <!-- Pagination (will be dynamically updated) -->
            <div id="pagination" class="flex justify-center mt-12 hidden">
                <nav class="flex space-x-2" aria-label="Pagination">
                    <!-- Pagination links will be generated here -->
                </nav>
            </div>

        </div>
    </main>

    <!-- Footer Section (Consistent with Landing Page) -->
    <footer class="bg-gray-800 text-white py-10 px-6 md:px-8 lg:px-12 rounded-t-xl">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- About Us -->
            <div>
                <h3 class="text-lg font-semibold mb-4 text-green-300">The Everything Shop</h3>
                <p class="text-gray-400 text-sm">Dedicated to bringing you the best sustainable and eco-friendly products for a better world.</p>
            </div>
            <!-- Quick Links -->
            <div>
                <h3 class="text-lg font-semibold mb-4 text-green-300">Quick Links</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Shop All</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Our Mission</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">FAQs</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Shipping & Returns</a></li>
                </ul>
            </div>
            <!-- Categories -->
            <div>
                <h3 class="text-lg font-semibold mb-4 text-green-300">Categories</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Home & Living</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Fashion</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Beauty & Wellness</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Kids & Baby</a></li>
                </ul>
            </div>
            <!-- Contact Us -->
            <div>
                <h3 class="text-lg font-semibold mb-4 text-green-300">Contact Us</h3>
                <p class="text-gray-400 text-sm">
                    123 Eco-Lane, Green City, GC 10001<br>
                    Email: info@everythingshop.com<br>
                    Phone: +1 (555) 123-4567
                </p>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-500 text-sm">
            &copy; 2025 The Everything Shop. All rights reserved.
        </div>
    </footer>

    <script type="module">
        // Firebase imports (already present, adding for completeness in this snippet)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // Global Firebase configuration and auth token provided by Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Fallback for local testing
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyDUfNKlbvZb0qBOAHx6xE9tt2Ynt3Ni_WY",
            authDomain: "the-everthing-shop.firebaseapp.com",
            projectId: "the-everthing-shop",
            storageBucket: "the-everthing-shop.firebasestorage.app",
            messagingSenderId: "221853475531",
            appId: "1:221853475531:web:b19738e10abb9c5379314e",
            measurementId: "G-CE0PH39T4E"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? initialAuthToken : null;

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);


        let allProducts = []; // Stores all mock products locally
        let displayedProducts = []; // Stores products currently displayed after filters/sort
        const productsPerPage = 8; // Number of products to display per page
        let currentPage = 1; // Current page number
        let cart = []; // Stores items in the cart

        // DOM elements
        const productsGrid = document.getElementById('products-grid');
        const loadingIndicator = document.getElementById('loading-indicator');
        const noProductsMessage = document.getElementById('no-products-message');
        const productCountElement = document.getElementById('product-count');
        const sortBySelect = document.getElementById('sort-by');
        const filterByCategorySelect = document.getElementById('filter-category');
        const paginationContainer = document.getElementById('pagination');
        const searchInput = document.getElementById('search-input');
        const cartCountElement = document.getElementById('cart-count');
        const cartIcon = document.getElementById('cart-icon');
        const authLinkContainer = document.getElementById('auth-link-container');


        /**
         * Displays a temporary message to the user.
         * @param {string} message - The message to display.
         * @param {number} duration - How long the message should be visible in milliseconds.
         */
        function showEphemeralMessage(message, duration = 3000) {
            let messageBox = document.getElementById('ephemeral-message-box');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'ephemeral-message-box';
                messageBox.className = 'fixed bottom-5 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-xl opacity-0 transition-opacity duration-300 z-50 text-center';
                document.body.appendChild(messageBox);
            }
            messageBox.textContent = message;
            messageBox.classList.remove('opacity-0', 'hidden');
            messageBox.classList.add('opacity-100');

            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
                // Hide completely after transition to avoid taking up space/being focusable
                setTimeout(() => messageBox.classList.add('hidden'), 300);
            }, duration);
        }

        /**
         * Initializes and loads data (mock products, cart) for the page.
         */
        async function initializeAndLoadData() {
            // Define mock products directly in the code - with real image URLs!
            allProducts = [
                {
                    id: 'prod001', name: "Bamboo Toothbrush Set", description: "Biodegradable and eco-friendly alternative for oral hygiene.", price: 9.99, imageUrl: "https://m.media-amazon.com/images/I/718y0k1+rSL._AC_UF890,1000_QL80_.jpg", category: "personal-care", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 30)).toISOString(), isFeatured: true
                },
                {
                    id: 'prod002', name: "Natural Solid Shampoo Bar", description: "Plastic-free and nourishing for all hair types.", price: 12.50, imageUrl: "https://www.ethique.com/cdn/shop/files/Haircare-Bar-Shampoo-Bar-Heali-Kiwi-Ethique.png?v=1716327092&width=1600", category: "personal-care", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 60)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod003', name: "Organic Produce Bags (Set of 3)", description: "Reduce plastic waste with these versatile mesh bags.", price: 15.00, imageUrl: "https://organicbasics.com/cdn/shop/files/organic-basics-mesh-produce-bag-3-pack-sand_800x.jpg?v=1708453488", category: "home", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 90)).toISOString(), isFeatured: true
                },
                {
                    id: 'prod004', name: "Countertop Compost Bin", description: "Stylish and compact, perfect for indoor food waste collection.", price: 35.99, imageUrl: "https://zerowastestore.com/cdn/shop/files/compost-bin-white-composter-6-5-l_720x.jpg?v=1704221193", category: "home", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 120)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod005', name: "Portable Solar Power Bank", description: "Charge your devices using clean solar energy on the go.", price: 49.95, imageUrl: "https://www.powerextra.com/cdn/shop/products/PE-PB026-B_1.jpg?v=1661332731&width=1445", category: "electronics", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 15)).toISOString(), isFeatured: true
                },
                {
                    id: 'prod006', name: "Eco-Friendly Cleaning Kit", description: "Non-toxic, plant-based cleaning solutions for a healthy home.", price: 29.00, imageUrl: "https://thrivemarket.com/static/images/cat_assets/category_page_hero_eco_friendly_cleaning.webp", category: "home", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 45)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod007', name: "Insulated Reusable Coffee Cup", description: "Enjoy your hot beverages sustainably on the go.", price: 16.75, imageUrl: "https://assets.weareevergreen.com/images/products/reusable-coffee-cups/travel-mug-12oz-grey-frank-green.webp?auto=format%2Ccompress&fit=fillmax&w=1200", category: "kitchen", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 70)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod008', name: "Beeswax Food Wraps (Mixed Sizes)", description: "Natural, reusable, and biodegradable food storage.", price: 22.00, imageUrl: "https://cdn.shopify.com/s/files/1/0088/8774/2498/files/beeswax-food-wraps-assorted-3-pack.png?v=1686733221", category: "kitchen", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 100)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod009', name: "Plantable Seed Pencils (Pack of 5)", description: "Once used, plant them to grow herbs or flowers.", price: 11.50, imageUrl: "https://www.sproutworld.com/app/uploads/2021/04/original_pencils_5_pack_black_square-800x800.jpg", category: "accessories", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 20)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod010', name: "Reusable Make-up Remover Pads", description: "Soft, washable pads for an eco-friendly beauty routine.", price: 14.99, imageUrl: "https://cdn.shopify.com/s/files/1/0073/3565/5608/products/OrganicCottonRounds-10pack.jpg?v=1602737603", category: "personal-care", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 50)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod011', name: "Stainless Steel Lunch Box", description: "Durable and leak-proof, perfect for school or work.", price: 28.00, imageUrl: "https://www.onyxcontainers.com/cdn/shop/products/lunchbox_main_1024x1024.jpg?v=1571271109", category: "kitchen", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 80)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod012', name: "Biodegradable Phone Case", description: "Protect your phone and the planet with this compostable case.", price: 24.00, imageUrl: "https://m.media-amazon.com/images/I/71i-y6s-R8L._AC_UF890,1000_QL80_.jpg", category: "electronics", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 110)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod013', name: "Recycled Cotton T-Shirt", description: "Comfortable and stylish t-shirt made from 100% recycled cotton.", price: 35.00, imageUrl: "https://www.tshirt-supplier.com/cdn/shop/products/recycled-cotton-t-shirt-womens_1024x1024.jpg?v=1603750849", category: "apparel", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 10)).toISOString(), isFeatured: true
                },
                {
                    id: 'prod014', name: "Upcycled Denim Tote Bag", description: "Unique and durable tote bag crafted from repurposed denim.", price: 45.00, imageUrl: "https://i.etsystatic.com/22900760/r/il/64c39f/3697960301/il_fullxfull.3697960301_dky0.jpg", category: "apparel", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 25)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod015', name: "Organic Baby Onesie", description: "Soft and safe for your little one, made from GOTS certified organic cotton.", price: 20.00, imageUrl: "https://www.happiestbaby.com/cdn/shop/files/sleepea-organic-cotton-swaddle-sky-star_grande.jpg?v=1680556108", category: "kids-baby", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 40)).toISOString(), isFeatured: true
                },
                {
                    id: 'prod016', name: "Wooden Building Blocks (Set)", description: "Classic, durable, and non-toxic wooden blocks for creative play.", price: 30.00, imageUrl: "https://cdn.shopify.com/s/files/1/0080/6360/4042/products/wooden-building-blocks-2.jpg?v=1600371694", category: "kids-baby", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 55)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod017', name: "Collapsible Camping Spork", description: "Lightweight and reusable spork for your outdoor adventures.", price: 8.00, imageUrl: "https://m.media-amazon.com/images/I/71T090i51nL._AC_UF890,1000_QL80_.jpg", category: "outdoor", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 75)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod018', name: "Biodegradable Sunscreen Stick", description: "Reef-safe and eco-friendly sun protection for your outdoor activities.", price: 18.00, imageUrl: "https://attitudeliving.com/cdn/shop/products/Sunly_Sunscreen_Stick_SPF30_Tropical_Leaves_600x600_crop_center.png?v=1658140409", category: "personal-care", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 85)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod019', name: "Ebook: Sustainable Living Guide", description: "A comprehensive guide to living a more eco-conscious life.", price: 9.99, imageUrl: "https://m.media-amazon.com/images/I/51-mQcK+t+L._SL500_AA300_.jpg", category: "books", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 5)).toISOString(), isFeatured: true
                },
                {
                    id: 'prod020', name: "Reusable Notebook (Erasable)", description: "Write, scan, erase, and reuse this innovative notebook.", price: 25.00, imageUrl: "https://m.media-amazon.com/images/I/71u9yH0jS-L.jpg", category: "accessories", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 95)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod021', name: "Hemp Backpack", description: "Durable and stylish backpack made from sustainable hemp fibers.", price: 60.00, imageUrl: "https://www.etsy.com/img/share/listing/717897257/il_fullxfull.12345.2452292305_41a1.jpg", category: "apparel", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 105)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod022', name: "Eco-Friendly Yoga Mat", description: "Non-toxic and biodegradable yoga mat for your practice.", price: 55.00, imageUrl: "https://completeunityyoga.com/cdn/shop/products/yoga-mat-eco-green-yoga.jpg?v=1678880496", category: "personal-care", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 115)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod023', name: "Water Filter Pitcher", description: "Reduce plastic bottle waste with this advanced water filter system.", price: 40.00, imageUrl: "https://m.media-amazon.com/images/I/71y7-074+CL._AC_UF890,1000_QL80_.jpg", category: "home", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 130)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod024', name: "Smart Home Energy Monitor", description: "Track and reduce your household energy consumption.", price: 75.00, imageUrl: "https://www.currys.co.uk/images/products/6500/65005884_2086_M_Feature.jpg", category: "electronics", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 140)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod025', name: "Recycled Glass Art Piece", description: "Beautiful and unique art made from repurposed glass.", price: 120.00, imageUrl: "https://www.thisiscolossal.com/wp-content/uploads/2016/06/jason-teague-1.jpg", category: "home", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 150)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod026', name: "Solar-Powered Garden Lights (Set of 4)", description: "Illuminate your garden sustainably with these elegant lights.", price: 49.00, imageUrl: "https://www.ikea.com/us/en/images/products/solvinden-led-solar-powered-string-light-outdoor-30-smart-lighting-white__1077595_pe857187_s5.jpg?f=s", category: "outdoor", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 160)).toISOString(), isFeatured: true
                },
                {
                    id: 'prod027', name: "Stainless Steel Straws (Pack of 4)", description: "Reusable and eco-friendly alternative to plastic straws.", price: 10.00, imageUrl: "https://m.media-amazon.com/images/I/61N+E2hF33L._AC_UF890,1000_QL80_.jpg", category: "kitchen", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 170)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod028', name: "Biodegradable Pet Waste Bags (Roll)", description: "Compostable bags for responsible pet waste disposal.", price: 8.50, imageUrl: "https://www.greenpoopbag.co.uk/cdn/shop/products/green-poop-bags-with-handles.jpg?v=1647466144", category: "home", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 180)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod029', name: "Recycled Paper Journal", description: "Eco-friendly journal with unbleached, recycled paper.", price: 15.00, imageUrl: "https://www.etsy.com/img/share/listing/1324021200/il_fullxfull.12345.4124045398_e0a1.jpg", category: "books", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 190)).toISOString(), isFeatured: false
                },
                {
                    id: 'prod030', name: "Wooden Toy Car Set", description: "Safe, non-toxic, and durable wooden toy cars for kids.", price: 28.00, imageUrl: "https://m.media-amazon.com/images/I/81+XF4Q0pL._AC_UF890,1000_QL80_.jpg", category: "kids-baby", created_at: new Date(Date.now() - (Math.random() * 1000 * 60 * 60 * 24 * 200)).toISOString(), isFeatured: true
                }
            ];

            loadCartFromLocalStorage(); // Load cart from local storage
            applyFiltersAndSort(); // Apply initial filters/sort and render products
        }

        /**
         * Renders product cards into the grid.
         * @param {Array} productsToRender - The array of products to display.
         */
        function renderProducts(productsToRender) {
            productsGrid.innerHTML = ''; // Clear previous products
            if (productsToRender.length === 0) {
                noProductsMessage.classList.remove('hidden');
                productCountElement.textContent = '0 products found.';
                paginationContainer.classList.add('hidden');
                return;
            } else {
                noProductsMessage.classList.add('hidden');
            }

            // Calculate start and end index for pagination
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const productsForPage = productsToRender.slice(startIndex, endIndex);

            productsForPage.forEach(product => {
                const productCard = `
                    <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-2 transition duration-300 flex flex-col overflow-hidden cursor-pointer" data-product-id="${product.id}">
                        <img src="${product.imageUrl || 'https://placehold.co/400x300/F0F8F0/4CAF50?text=No+Image'}" alt="${product.name}" class="w-full h-48 object-cover rounded-t-xl" onerror="this.onerror=null;this.src='https://placehold.co/400x300/F0F8F0/4CAF50?text=No+Image';">
                        <div class="p-6 flex-grow flex flex-col justify-between">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">${product.name}</h3>
                                <p class="text-gray-600 text-sm mb-4">${product.description}</p>
                            </div>
                            <div class="flex justify-between items-center mt-auto pt-4 border-t border-gray-100">
                                <span class="text-green-700 text-2xl font-bold">GHS ${product.price ? product.price.toFixed(2) : 'N/A'}</span>
                                <button class="add-to-cart-btn bg-green-100 text-green-700 hover:bg-green-200 py-2 px-4 rounded-full text-sm font-medium transition duration-300" data-product-id="${product.id}" data-product-name="${product.name}" data-product-price="${product.price}">Add to Cart</button>
                            </div>
                        </div>
                    </div>
                `;
                productsGrid.insertAdjacentHTML('beforeend', productCard);
            });

            // Update product count display
            productCountElement.textContent = `${productsToRender.length} products found.`;
            setupPagination(productsToRender.length);
            addEventListenersToProductCards();
            addEventListenersToAddToCartButtons();
        }

        /**
         * Applies current filters, search, and sort order to allProducts and updates the display.
         */
        function applyFiltersAndSort() {
            let filtered = [...allProducts]; // Start with a copy of all products

            // Apply search filter
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (searchTerm) {
                filtered = filtered.filter(product =>
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm) ||
                    (product.category && product.category.toLowerCase().includes(searchTerm))
                );
            }

            // Apply category filter
            const selectedCategory = filterByCategorySelect.value;
            if (selectedCategory !== 'all') {
                filtered = filtered.filter(product => product.category === selectedCategory);
            }

            // Apply sorting
            const sortBy = sortBySelect.value;
            if (sortBy === 'price-asc') {
                filtered.sort((a, b) => a.price - b.price);
            } else if (sortBy === 'price-desc') {
                filtered.sort((a, b) => b.price - a.price);
            } else if (sortBy === 'new-arrivals') {
                // Sort by created_at timestamp for new arrivals (descending)
                filtered.sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());
            }
            // 'recommended' doesn't require specific sorting here, maintains original order or default

            displayedProducts = filtered;
            currentPage = 1; // Reset to first page after applying filters/sort
            renderProducts(displayedProducts);
        }

        /**
         * Sets up pagination links based on the total number of products.
         * @param {number} totalProducts - Total number of products after filtering.
         */
        function setupPagination(totalProducts) {
            const totalPages = Math.ceil(totalProducts / productsPerPage);
            const navElement = paginationContainer.querySelector('nav');
            navElement.innerHTML = ''; // Clear existing pagination

            if (totalPages <= 1) {
                paginationContainer.classList.add('hidden');
                return;
            } else {
                paginationContainer.classList.remove('hidden');
            }

            // Previous button
            const prevButton = document.createElement('a');
            prevButton.href = "#";
            prevButton.textContent = "Previous";
            prevButton.classList.add('px-4', 'py-2', 'text-gray-500', 'bg-white', 'rounded-lg', 'shadow-md', 'hover:bg-gray-100');
            if (currentPage === 1) {
                prevButton.classList.add('opacity-50', 'pointer-events-none');
            }
            prevButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentPage > 1) {
                    currentPage--;
                    renderProducts(displayedProducts);
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top
                }
            });
            navElement.appendChild(prevButton);

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const pageLink = document.createElement('a');
                pageLink.href = "#";
                pageLink.textContent = i;
                pageLink.classList.add('px-4', 'py-2', 'rounded-lg', 'shadow-md');
                if (i === currentPage) {
                    pageLink.classList.add('text-white', 'bg-green-600');
                    pageLink.classList.remove('text-gray-700', 'bg-white', 'hover:bg-gray-100');
                } else {
                    pageLink.classList.add('text-gray-700', 'bg-white', 'hover:bg-gray-100');
                }
                pageLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage = i;
                    renderProducts(displayedProducts);
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top
                });
                navElement.appendChild(pageLink);
            }

            // Next button
            const nextButton = document.createElement('a');
            nextButton.href = "#";
            nextButton.textContent = "Next";
            nextButton.classList.add('px-4', 'py-2', 'text-gray-500', 'bg-white', 'rounded-lg', 'shadow-md', 'hover:bg-gray-100');
            if (currentPage === totalPages) {
                nextButton.classList.add('opacity-50', 'pointer-events-none');
            }
            nextButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentPage < totalPages) {
                    currentPage++;
                    renderProducts(displayedProducts);
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top
                }
            });
            navElement.appendChild(nextButton);
        }

        /**
         * Adds event listeners to product cards for navigation to a product detail page.
         */
        function addEventListenersToProductCards() {
            document.querySelectorAll('#products-grid > div[data-product-id]').forEach(card => {
                card.addEventListener('click', function(event) {
                    // Prevent click on 'Add to Cart' button from triggering card click
                    if (!event.target.closest('.add-to-cart-btn')) {
                        const productId = this.dataset.productId;
                        console.log(`Navigating to product detail for ID: ${productId}`);
                        // In a real application, you would navigate to product-detail.html with the product ID
                        window.location.href = `product-detail.html?id=${productId}`;
                    }
                });
            });
        }

        /**
         * Adds event listeners to 'Add to Cart' buttons.
         */
        function addEventListenersToAddToCartButtons() {
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function(event) {
                    event.stopPropagation(); // Stop event bubbling to the product card
                    const productId = this.dataset.productId;
                    const productName = this.dataset.productName;
                    // Find the product in allProducts to get its price
                    const product = allProducts.find(p => p.id === productId);
                    if (product) {
                        addToCart(productId, productName, product.price);
                    } else {
                        console.error("Product not found for adding to cart:", productId);
                        showEphemeralMessage("Error: Could not add product to cart.", 4000);
                    }
                });
            });
        }

        /**
         * Loads cart data from localStorage.
         */
        function loadCartFromLocalStorage() {
            try {
                const storedCart = localStorage.getItem('ecoShopCart');
                cart = storedCart ? JSON.parse(storedCart) : [];
                updateCartCountDisplay();
            } catch (e) {
                console.error("Error loading cart from local storage:", e);
                cart = []; // Reset cart if corrupted
            }
        }

        /**
         * Saves cart data to localStorage.
         */
        function saveCartToLocalStorage() {
            try {
                localStorage.setItem('ecoShopCart', JSON.stringify(cart));
            } catch (e) {
                console.error("Error saving cart to local storage:", e);
            }
        }

        /**
         * Updates the cart item count displayed in the header.
         */
        function updateCartCountDisplay() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCountElement.textContent = totalItems;
            if (totalItems > 0) {
                cartCountElement.classList.remove('hidden');
            } else {
                cartCountElement.classList.add('hidden');
            }
        }

        /**
         * Adds a product to the cart or increments its quantity.
         * @param {string} productId - The ID of the product to add.
         * @param {string} productName - The name of the product.
         * @param {number} productPrice - The price of the product.
         */
        function addToCart(productId, productName, productPrice) {
            const existingItemIndex = cart.findIndex(item => item.id === productId);
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity++;
            } else {
                cart.push({ id: productId, name: productName, price: productPrice, quantity: 1 });
            }
            saveCartToLocalStorage();
            updateCartCountDisplay();
            showEphemeralMessage(`Added "${productName}" to cart!`);
            console.log("Current Cart:", cart); // For debugging
        }

        // --- Firebase Authentication Listener for Header ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const displayName = user.displayName || user.email;
                authLinkContainer.innerHTML = `
                    <a href="profile.html" class="text-green-700 font-bold mr-2 hover:underline">Welcome, ${displayName.split('@')[0]}!</a>
                    <button id="logout-btn" class="text-gray-600 hover:text-green-700 font-medium transition duration-300">Logout</button>
                `;
                document.getElementById('logout-btn').addEventListener('click', handleLogout);
            } else {
                authLinkContainer.innerHTML = `
                    <a href="authentication.html" class="text-gray-600 hover:text-green-700 font-medium transition duration-300" id="account-link">Account</a>
                `;
                if (initialAuthToken) {
                    signInWithCustomToken(auth, initialAuthToken)
                        .then(() => console.log("Signed in with custom token."))
                        .catch((error) => console.error("Error signing in with custom token:", error));
                } else {
                    signInAnonymously(auth)
                        .then(() => console.log("Signed in anonymously."))
                        .catch((error) => console.error("Error signing in anonymously:", error));
                }
            }
        });

        /**
         * Handles user logout.
         */
        async function handleLogout() {
            try {
                await signOut(auth);
                showEphemeralMessage("You have been logged out.", 3000, 'info');
                // UI update and redirection handled by onAuthStateChanged
            } catch (error) {
                console.error("Logout Error:", error);
                showEphemeralMessage("Error logging out. Please try again.", 3000, 'error');
            }
        }


        // Event listeners for sort, filter, and search changes
        sortBySelect.addEventListener('change', applyFiltersAndSort);
        filterByCategorySelect.addEventListener('change', applyFiltersAndSort);
        searchInput.addEventListener('input', applyFiltersAndSort); // Listen for real-time search input

        // Event listener for the cart icon (now links to cart page)
        cartIcon.addEventListener('click', (e) => {
            // No e.preventDefault() here, as we want the link to work
            // If you wanted to do something *before* navigating, you could add it here
        });

        // Initialize data when the DOM is fully loaded
        window.onload = initializeAndLoadData;
    </script>
</body>
</html>
